<!DOCTYPE html>
<html>
   <head>
      <title>Image Overlay Example</title>
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
       <link rel="shortcut icon" href="#">
       <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js" crossorigin="anonymous"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js" crossorigin="anonymous"></script>
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <style>
            #map {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              height: 100vh;
              width: 100vw;
              z-index: 1;
            }

            .leaflet-image-layer {
              z-index: 2;
            }

      </style>
   </head>

   <body>
      <div id = "map"></div>
      <script>
         var map = L.map('map', {
              minZoom: 2
            }).setView([41.188806, 28.980162], 10);
         var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
             maxZoom: 19,
             attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'
         })

         // Add only the selected layer back to the map
         var selectedLayer = osmLayer
         selectedLayer.addTo(map);


         // Creating Image overlay
         var imageUrl = '/static/kadikoy_jpeg.jpeg';
         var latLngBounds = [[40.9747965829999998, 29.0496402310000015], [41.0002034210000019, 29.0753493680000012]];
         var overlay = L.imageOverlay(imageUrl, latLngBounds);
         overlay.addTo(map);

         var drawnItems = new L.FeatureGroup();
         map.addLayer(drawnItems);

         var drawControl = new L.Control.Draw({
           edit: {
             featureGroup: drawnItems
           },
           draw: {
              polygon: true,
              marker: {
                 icon: new L.Icon.Default(),
                 repeatMode: true
              },
              circle: false,
              rectangle: false,
              polyline: false,
              circlemarker: false
           }
         });
         map.addControl(drawControl);

         map.on('draw:created', function (e) {
           var layer = e.layer;
           drawnItems.addLayer(layer);

            var type = e.layerType,
               layer = e.layer;
            if (type === 'marker') {
               // Do something with the marker here, e.g. send it to the server
                var latlng = layer.getLatLng();
                var locationValue = prompt("Please enter the location value:", "");

                console.log(layer.toGeoJSON());
                $.ajax({
                    url: '/save-points',
                    type: 'POST',
                    data: JSON.stringify({points: layer.toGeoJSON()}),
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function(response) {
                        console.log("success_return_log", response);
                        addedLayer = L.geoJSON(response).addTo(map);
                        addedLayers.push(addedLayer);

                        // Add the properties to the marker popup
                        layer.bindPopup('Location: ' + locationValue + '<br>Latitude: ' + latlng.lat.toFixed(6) +
                            '<br>Longitude: ' + latlng.lng.toFixed(6))

                    },
                    error: function(error) {
                        console.log("fail_return_log", error);
                    }
                });
                // console.log("drawnItems_log", drawnItems.toGeoJSON()); // log the GeoJSON data
            }


         });

      </script>
   </body>

</html>